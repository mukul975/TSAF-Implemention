{{ define "email.tsaf.subject" }}
TSAF {{ .Status | toUpper }}: {{ .GroupLabels.alertname }} ({{ .Alerts | len }} alerts)
{{ end }}

{{ define "email.tsaf.html" }}
<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; }
        .alert { border-left: 4px solid; padding: 10px; margin: 10px 0; }
        .critical { border-color: #d32f2f; background-color: #ffebee; }
        .warning { border-color: #f57c00; background-color: #fff3e0; }
        .info { border-color: #1976d2; background-color: #e3f2fd; }
        .resolved { border-color: #388e3c; background-color: #e8f5e8; }
        .title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .description { margin: 5px 0; }
        .details { background-color: #f5f5f5; padding: 8px; border-radius: 4px; margin: 5px 0; }
        .label { font-weight: bold; }
        .timestamp { color: #666; font-size: 12px; }
    </style>
</head>
<body>
    <h2>TSAF Alert Notification</h2>

    {{ if eq .Status "firing" }}
    <p><strong>Status:</strong> ðŸ”¥ FIRING ({{ .Alerts | len }} alerts)</p>
    {{ else }}
    <p><strong>Status:</strong> âœ… RESOLVED ({{ .Alerts | len }} alerts)</p>
    {{ end }}

    {{ range .Alerts }}
    <div class="alert {{ if eq .Status "firing" }}{{ .Labels.severity }}{{ else }}resolved{{ end }}">
        <div class="title">{{ .Annotations.summary }}</div>
        <div class="description">{{ .Annotations.description }}</div>

        <div class="details">
            <div><span class="label">Service:</span> {{ .Labels.service }}</div>
            <div><span class="label">Severity:</span> {{ .Labels.severity | upper }}</div>
            {{ if .Labels.category }}<div><span class="label">Category:</span> {{ .Labels.category }}</div>{{ end }}
            {{ if .Labels.agent_id }}<div><span class="label">Agent ID:</span> {{ .Labels.agent_id }}</div>{{ end }}
            {{ if .Labels.protocol }}<div><span class="label">Protocol:</span> {{ .Labels.protocol }}</div>{{ end }}
            {{ if .Labels.vulnerability_type }}<div><span class="label">Vulnerability Type:</span> {{ .Labels.vulnerability_type }}</div>{{ end }}
        </div>

        <div class="timestamp">
            <strong>Started:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
            {{ if .EndsAt }}<br><strong>Ended:</strong> {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
        </div>
    </div>
    {{ end }}

    <hr>
    <p style="font-size: 12px; color: #666;">
        This alert was generated by the TSAF (Translation Security Analysis Framework) monitoring system.
        <br>For more details, check the Grafana dashboards or contact the TSAF team.
    </p>
</body>
</html>
{{ end }}

{{ define "email.tsaf.text" }}
TSAF Alert Notification
========================

Status: {{ .Status | upper }} ({{ .Alerts | len }} alerts)

{{ range .Alerts }}
Alert: {{ .Annotations.summary }}
Description: {{ .Annotations.description }}

Details:
- Service: {{ .Labels.service }}
- Severity: {{ .Labels.severity | upper }}
{{ if .Labels.category }}- Category: {{ .Labels.category }}{{ end }}
{{ if .Labels.agent_id }}- Agent ID: {{ .Labels.agent_id }}{{ end }}
{{ if .Labels.protocol }}- Protocol: {{ .Labels.protocol }}{{ end }}
{{ if .Labels.vulnerability_type }}- Vulnerability Type: {{ .Labels.vulnerability_type }}{{ end }}

Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .EndsAt }}Ended: {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}

---
{{ end }}

This alert was generated by the TSAF monitoring system.
{{ end }}